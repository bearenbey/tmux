# ╔══════════════════════════════════════════════════════════════╗
# ║          EREN'S TMUX CONFIGURATION                           ║
# ╚══════════════════════════════════════════════════════════════╝

# ── Core Settings ─────────────────────────────────────────────
set -g default-terminal "tmux-256color"
set -ag terminal-overrides ",xterm-256color:RGB"
set -g history-limit 50000
set -g mouse on
set -g base-index 1
setw -g pane-base-index 1
set -g renumber-windows on
set -g set-clipboard on
set -g escape-time 0
set -g focus-events on
set -g display-time 3000
set -g display-panes-time 2000
set -g status-interval 5
setw -g aggressive-resize on
setw -g monitor-activity on
set -g visual-activity off

# ── Prefix ────────────────────────────────────────────────────
# Ctrl-a as primary prefix (more ergonomic), keep Ctrl-b as backup
set -g prefix C-a
set -g prefix2 C-b
bind C-a send-prefix

# ── Reload Config ─────────────────────────────────────────────
bind r source-file ~/.tmux.conf \; display-message "Config reloaded"

# ── Window Management ─────────────────────────────────────────
bind c new-window -c "#{pane_current_path}"
bind n next-window
bind p previous-window
bind Tab last-window

# Intuitive splits that open in the current directory
bind | split-window -h -c "#{pane_current_path}"
bind \\ split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"
bind _ split-window -v -c "#{pane_current_path}"

# Quick window selection
bind -n M-1 select-window -t 1
bind -n M-2 select-window -t 2
bind -n M-3 select-window -t 3
bind -n M-4 select-window -t 4
bind -n M-5 select-window -t 5
bind -n M-6 select-window -t 6
bind -n M-7 select-window -t 7
bind -n M-8 select-window -t 8
bind -n M-9 select-window -t 9

# ── Pane Navigation (vim-style) ──────────────────────────────
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# Alt+arrow pane navigation (no prefix needed)
bind -n M-Left select-pane -L
bind -n M-Right select-pane -R
bind -n M-Up select-pane -U
bind -n M-Down select-pane -D

# ── Pane Resizing ─────────────────────────────────────────────
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# Fine-grained resize with arrow keys
bind -r Left resize-pane -L 2
bind -r Down resize-pane -D 2
bind -r Up resize-pane -U 2
bind -r Right resize-pane -R 2

# ── Pane Operations ──────────────────────────────────────────
bind x kill-pane             # Kill pane without confirmation
bind X kill-window           # Kill window
bind z resize-pane -Z        # Toggle zoom
bind Space next-layout       # Cycle layouts
bind m set-option -g mouse   # Toggle mouse on/off

# Swap panes
bind > swap-pane -D
bind < swap-pane -U

# ── Copy Mode (vi-style) ─────────────────────────────────────
setw -g mode-keys vi
bind Enter copy-mode
bind -T copy-mode-vi v send-keys -X begin-selection
bind -T copy-mode-vi C-v send-keys -X rectangle-toggle
bind -T copy-mode-vi y send-keys -X copy-selection-and-cancel
bind -T copy-mode-vi Escape send-keys -X cancel
bind -T copy-mode-vi H send-keys -X start-of-line
bind -T copy-mode-vi L send-keys -X end-of-line

# ── Session Management ───────────────────────────────────────
bind S command-prompt -p "New session:" "new-session -s '%%'"
bind s choose-tree -sZ       # Session picker with preview

# ── Colors / Theme ───────────────────────────────────────────
# Palette reference:
#   bg=#1a1816  bg_light=#2e2a26  bg_hl=#3e3a36
#   fg=#ddd5c8  fg_dim=#c4bcb0  muted=#706860
#   blue=#8898b4  cyan=#78a8a0  green=#88a878
#   magenta=#b88898  red=#c98a7a  yellow=#d4a85c  orange=#e0ba78

# ── Status Bar ───────────────────────────────────────────────
set -g status on
set -g status-position bottom
set -g status-justify left
set -g status-style "fg=#c4bcb0,bg=#1a1816"

# Left: session name powerline block
set -g status-left-length 40
set -g status-left "#[fg=#1a1816,bg=#8898b4,bold]  #S #[fg=#8898b4,bg=#1a1816] "

# Right: powerline segments — load · ram · date · time
set -g status-right-length 120
set -g status-right "#{?client_prefix,#[fg=#e0ba78,bg=#1a1816]#[fg=#1a1816,bg=#e0ba78,bold]  #[fg=#e0ba78,bg=#1a1816] ,}#[fg=#2e2a26,bg=#1a1816]#[fg=#88a878,bg=#2e2a26]  #(cat /proc/loadavg | cut -d' ' -f1) #[fg=#3e3a36,bg=#2e2a26]#[fg=#78a8a0,bg=#3e3a36]  #(free -h | awk '/Mem/{print $3"/"$2}') #[fg=#2e2a26,bg=#3e3a36]#[fg=#c4bcb0,bg=#2e2a26]  %b %d #[fg=#8898b4,bg=#2e2a26]#[fg=#1a1816,bg=#8898b4,bold]  %H:%M "

# Window tabs: inactive — powerline segment
setw -g window-status-format "#[fg=#2e2a26,bg=#1a1816]#[fg=#706860,bg=#2e2a26] #I #W#{?window_zoomed_flag, ,} #[fg=#2e2a26,bg=#1a1816]"

# Window tabs: active — bright powerline segment
setw -g window-status-current-format "#[fg=#78a8a0,bg=#1a1816]#[fg=#1a1816,bg=#78a8a0,bold] #I #W#{?window_zoomed_flag, ,} #[fg=#78a8a0,bg=#1a1816]"

setw -g window-status-activity-style "fg=#d4a85c"
setw -g window-status-separator " "

# ── Pane Borders ─────────────────────────────────────────────
set -g pane-border-style "fg=#3e3a36"
set -g pane-active-border-style "fg=#8898b4"
set -g pane-border-lines single
set -g pane-border-indicators colour

# ── Messages & Menus ─────────────────────────────────────────
set -g message-style "fg=#78a8a0,bg=#2e2a26,bold"
set -g message-command-style "fg=#e0ba78,bg=#2e2a26"
set -g mode-style "fg=#1a1816,bg=#8898b4"

# ── Popup / Display Pane ─────────────────────────────────────
set -g display-panes-colour "#c4bcb0"
set -g display-panes-active-colour "#8898b4"
set -g popup-border-style "fg=#3e3a36"
set -g popup-border-lines rounded

# ── Clock Mode ───────────────────────────────────────────────
setw -g clock-mode-colour "#8898b4"
setw -g clock-mode-style 24

# ── Welcome Popup ─────────────────────────────────────────────
set-hook -g after-new-session 'run-shell -b "bash ~/.tmux/popup.sh"'
bind / display-popup -w 46 -h 25 -E "bash ~/.tmux/welcome.sh"

# ── Plugins (TPM) ────────────────────────────────────────────
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'tmux-plugins/tmux-yank'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'

# Plugin settings
set -g @resurrect-capture-pane-contents 'on'
# set -g @continuum-restore 'on'  # enable after first save (prefix + Ctrl-s)
set -g @continuum-save-interval '10'
set -g @yank_selection_mouse 'clipboard'

# Initialize TPM (keep at bottom)
run '~/.tmux/plugins/tpm/tpm'
